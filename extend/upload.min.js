window.HN&&window.jQuery&&(HN.upload=function(){return{dialogUpload:function(a,e,d,c){HN.debug("DialogUploadForm is init");var b={uid:a,action:"upload"};HN.ajax.post("http://www.tazai.com/photo/album/list",b,function(f){var k=f.data,j=f.token;if(!j){HN.go("login,form",function(){HN.login().dialogLoginForm()});return false}var h=['<div class="fp-frame">','<div class="fp-title">\u4e0a\u4f20\u7167\u7247</div>','<div class="fp-whitebox" style="display:none;">','<div class="l fp-whitebox-w270">\u63d0\u793a\uff1a\u8bf7\u9009\u62e9jpg/gif\u683c\u5f0f\uff0c\u5355\u5f20\u7167\u7247\u4e0d\u80fd\u5927\u4e8e5M\uff0c\u6309Ctrl\u6216Shift\u952e\u53ef\u6700\u591a\u6279\u91cf\u4e0a\u4f2020\u5f20\u7167\u7247\uff01</div>','<div class="r fp-whitebox-button1"><a href="javascript:" id="upload-button">\u6b63\u5728\u52a0\u8f7d\u4e0a\u4f20\u7ec4\u4ef6..</a></div>',"</div>",'<div class="fp-yellowbox" style="height:75px; float:left;">','<div class="fp-y-title" style="display:none;">','<div class="fp-y-c1">\u7167\u7247</div>','<div class="fp-y-c3" id="title_state">\u5220\u9664</div>','<div class="fp-y-c2">\u5927\u5c0f</div>',"</div>",'<div class="fp-y-lists" id="upload-file-list" style="height:75px; ">','<div class="l fp-whitebox-w270" style="padding:10px;">\u63d0\u793a\uff1a\u8bf7\u9009\u62e9jpg/gif\u683c\u5f0f\uff0c\u5355\u5f20\u7167\u7247\u4e0d\u80fd\u5927\u4e8e5M\uff0c\u6309Ctrl\u6216Shift\u952e\u53ef\u6700\u591a\u6279\u91cf\u4e0a\u4f2020\u5f20\u7167\u7247\uff01</div>',"</div>",'<div style="clear:both"></div>','<div class="fp-y-buttom" style="margin-top:-70px">','<div class="fp-y-buttom-l" style="display:none"><img src="http://css.tazai.com/ui/mangoq/2010v1/images/ico/action_del_default.gif"></div>','<div class="l" style="display:none"><a id="clear_all_text" href="javascript:">\u6e05\u7a7a\u5217\u8868</a> <span id="upload-file-total"></span></div>','<div class="fp-y-buttom-r"><span id="spanButtonPlaceholder"></span></div>',"</div>","</div>",'<div class="e-20" style="height:12px;"></div>','<div class="c fp-selcts" id="photo_album_list_box">','<div class="l fp-fontbasic">\u4e0a\u4f20\u81f3\u76f8\u518c\uff1a</div>','<div class="l fp-selectbox">','<select id="photo_album_list">',"</select>","</div>",'<div class="r fp-selects-new">','<input name="" id="album_add_btn" type="image" src="http://css.tazai.com/ui/mangoq/2010v1/images/button/album_add.jpg" />',"</div>",'<div class="fp-selcts-child">',"<div>",'<div class="l">\u76f8\u518c\u540d\u79f0\uff1a</div>','<div class="r"><span>(\u6700\u591a20\u4e2a\u5b57\u7b26)</span></div>',"</div>",'<div class="c fp-selcts-input">','<input type="text" name="album_name" id="photo_album_creat_name" value="" />',"</div>","<div>",'<div class="l">','<img id="photo_album_creat" style="cursor:pointer;" src="http://css.tazai.com/ui/mangoq/2010v1/images/button/album_save.gif" />',"</div>",'<div class="l fp-selcts-more"><a href="javascript:" id="photo_album_cancel">\u53d6\u6d88</a></div>',"</div>","</div>","</div>",'<div class="c"></div>','<div class="c fp-save" id="save-button-box">','<div class="fp-save-button">','<input name="" type="image" id="upload_start_btn" src="http://css.tazai.com/ui/mangoq/2010v1/images/button/photo_upload.jpg" />',"</div>",'<div class="fp-save-more"><a href="javascript:" class="hn-dialog-close">\u53d6\u6d88</a></div>',"</div>","</div>"].join("");HN.dialog.open({body:h,disableBgClick:true,opacity:0.1,className:"f-all w-w454h428",width:454});HN.dialog.reSize(430,215);for(var g=0;g<k.length;g++){if(d&&k[g].album_id==d){$("#photo_album_list").append('<option value="'+k[g].album_id+'" selected="selected">'+k[g].album_name+"</option>")}else{$("#photo_album_list").append('<option value="'+k[g].album_id+'">'+k[g].album_name+"</option>")}}if(e==1){HN.dialog.reSize(540,285);$(".fp-frame").prepend('<div class="fp-notice">\u63d0\u793a\uff1a\u8be5\u7528\u6237\u5df2\u4e0a\u4f20\u591a\u5f20\u7167\u7247\uff0c\u60a8\u5fc5\u987b\u540c\u6837\u62e5\u6709 <span>3\u5f20</span> \u4ee5\u4e0a\u7167\u7247\u624d\u80fd\u6b23\u8d4fTA\u7684\u5168\u90e8\u9753\u7167\u54e6\uff01</div>')}$("#hn-dialog").fadeIn(200,function(){$("#album_add_btn").unbind("click").click(function(){$("#photo_album_list").hide(0);$(".fp-selcts-child").fadeIn();$("#photo_album_cancel").click(function(){$(".fp-selcts-child").fadeOut();$("#photo_album_list").show(0)});$("#photo_album_creat").unbind("click").click(function(){var n=$(this),m=$("#photo_album_creat_name").val();n.hide();if(m.length<1){alert("\u76f8\u518c\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a");n.show()}else{if(m.replace(/[^\x00-\xff]/g,"**").length>20){alert("\u76f8\u518c\u540d\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc720");n.show()}else{HN.ajax.post("http://www.tazai.com/photo/album/add",{album_name:m},function(o){$("#photo_album_list").prepend('<option selected value="'+o.album_id+'">'+o.album_name+"</option>");$(".fp-selcts-child").fadeOut();$("#photo_album_list").show(0);n.show()},function(o){HN.go("login,form",function(){HN.loadCSS("http://css.tazai.com/ui/mangoq/2010v1/css/reg.css");HN.login().dialogLoginForm()})})}}})});var l,i={options:function(){var m=window.upload=i;return{file_post_name:"Filedata",flash_url:"http://www.tazai.com/swfupload.swf",upload_url:"http://imgupload.tazai.com/upload_photo.php",post_params:{channel:"photo",token:j},file_size_limit:"5 MB",file_types:"*.jpg;*.jpeg;*.png;*.gif",file_types_description:"All Image Files",file_upload_limit:20,file_queue_limit:0,custom_settings:{progressTarget:"flashUploaderHolder",cancelButtonId:"btnCancel"},debug:false,prevent_swf_caching:false,button_image_url:HN.config.url.js+"image/photo_add.gif",button_width:"78",button_height:"23",button_placeholder_id:"spanButtonPlaceholder",file_queued_handler:m.fileQueued,file_queue_error_handler:m.fileQueuederr,file_dialog_complete_handler:m.fileDialogComplete,upload_start_handler:m.uploadStart,upload_progress_handler:m.uploadProgress,upload_error_handler:m.uploadError,upload_success_handler:m.uploadSuccess,upload_complete_handler:m.uploadComplete,queue_complete_handler:m.queueComplete,swfupload_pre_load_handler:m.swfUploadPreLoad,swfupload_load_failed_handler:m.swfUploadLoadFailed}},swfUploadLoaded:function(){this.debug("swfUploadLoaded")},fileCount:0,fileQueuederr:function(n,p,o){try{if(p===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){alert("\u4e00\u6b21\u6700\u591a\u53ea\u80fd\u4e0a\u4f2020\u5f20\u7167\u7247\uff01");return}switch(p){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:alert("\u53ea\u80fd\u4e0a\u4f205MB\u4ee5\u4e0b\u7684\u56fe\u7247!");break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:alert("\u4e0d\u80fd\u4e0a\u4f20\u7a7a\u56fe\u7247!");break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:alert("\u56fe\u7247\u683c\u5f0f\u4e0d\u7b26\u5408\u8981\u6c42!");break;default:alert("\u7cfb\u7edf\u9519\u8bef! \u8bf7\u7a0d\u5019\u518d\u8bd5");break}}catch(m){this.debug(m)}},getSizeInKMG:function(o){if(isNaN(!o)){return false}var m=+o,p=[" B"," KB"," MB"," GB"];for(var n=0;n<p.length;n+=1){if(m<1024){m=m+"";if(m.indexOf(".")!=-1&&m.indexOf(".")!=3){m=m.substring(0,4)}else{m=m.substring(0,3)}break}else{m=m/1024}}return m+p[n]},fileIds:[],changeHtml:false,fileQueued:function(n){var m=i;m.fileCount++;window.deleteOneFile=m.deleteOneFile;window.cancelAll=m.cancelAll;window.startUp=m.startUp;if(!m.changeHtml){HN.dialog.reSize(430,387);$(".fp-notice").remove();$("#upload-file-list").css("height","178px");$(".fp-y-buttom").attr("style","border-bottom:1px solid #C5B08B");$(".fp-y-buttom div").show();$(".fp-yellowbox .fp-y-title").show();$(".fp-yellowbox").css("height","245px");$(".fp-y-buttom-r").css("padding-top","5px");$("#upload-file-list").html("");m.changeHtml=true}$("#upload-file-list").append('<div class="fp-y-list" id="'+n.id+'"><div class="fp-y-c1">'+n.name+'</div><div class="fp-y-c3"><a href="javascript:" onclick="deleteOneFile(\''+n.id+'\')" class="m-ico-del" ><img class="del_img_ico" src="http://css.tazai.com/ui/mangoq/2010v1/images/ico/action_del_default.gif"></a></div><div class="fp-y-c2">'+m.getSizeInKMG(n.size)+"</div></div>");$(".del_img_ico").hover(function(){$(this).attr("src","http://css.tazai.com/ui/mangoq/2010v1/images/ico/action_del_on.gif")},function(){$(this).attr("src","http://css.tazai.com/ui/mangoq/2010v1/images/ico/action_del_default.gif")});if((m.fileCount)>5){$("#upload-file-list .fp-y-c3").css("text-align","right");$("#hn-dialog .fp-y-title").css("padding-right","16px");$("#upload-file-list").css("overflow-y","scroll")}$("#clear_all_text").bind("click",cancelAll);$("#upload_start_btn").bind("click",startUp);m.fileIds.push(n.id);m.updateTotal(n.size)},deleteOneFile:function(m){var n=l.getFile(m);if(!n){return}l.cancelUpload(m);$("#"+m).fadeOut(200,function(){$(this).remove()});i.fileCount--;if((i.fileCount)<=5){$("#upload-file-list .fp-y-c3").css("text-align","center");$("#hn-dialog .fp-y-title").css("padding-right","8px");$("#upload-file-list").css("overflow-y","hidden")}i.updateTotal(0-n.size)},totalSize:0,updateTotal:function(n){var m=i;if(!isNaN(n)){m.totalSize+=n}$("#upload-file-total").html("\u5171"+m.fileCount+"\u5f20\u7167\u7247(\u603b\u8ba1\uff1a"+m.getSizeInKMG(m.totalSize)+")")},cancelAll:function(p){var m=i,n=m.fileIds;for(var o=0;o<n.length;o++){m.deleteOneFile(n[o])}m.fileCount=0;m.totalSize=0;m.updateTotal();if(p==1){$("#hn-dialog").hide()}},startUp:function(){if(i.fileCount<1){return}$("#upload-file-list .del_img_ico").hide();$("#photo_album_list").attr("disabled","disabled");$("#upload_start_btn, #clear_all_text, #album_add_btn").unbind("click").css("cursor","default").css("color","#999");$("#title_state").html("\u72b6\u6001");l.setButtonDisabled(true);l.startUpload();document.getElementById("upload-file-list").parentNode.scrollTop=0},fileQueueError:function(){this.debug("fileQueueError")},fileDialogComplete:function(){this.debug("fileDialogComplete")},uploadStart:function(o){var p=l.getStats(),n=i,m=n.fileCount-p.files_queued+1,q=$("#"+o.id);if(q.length>0){q.css({background:"url(http://css.tazai.com/ui/mangoq/2010v1/images/bg/load_over.png) -480px 50% no-repeat"})}},uploadProgress:function(m,o,r){var n=400,p=$("#"+m.id),q=Math.ceil((o/m.size)*n),s=n-q;if(s>=0){p.css("backgroundPosition","-"+s+"px 0px")}else{p.css("backgroundPosition","0px 0px")}},uploadError:function(n,p,o){try{switch(p){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:this.debug("Error Code: HTTP Error, File name: "+n.name+", Message: "+o);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:this.debug("Error Code: Upload Failed, File name: "+n.name+", File size: "+n.size+", Message: "+o);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:this.debug("Error Code: IO Error, File name: "+n.name+", Message: "+o);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:this.debug("Error Code: Security Error, File name: "+n.name+", Message: "+o);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:this.debug("Error Code: Upload Limit Exceeded, File name: "+n.name+", File size: "+n.size+", Message: "+o);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:this.debug("Error Code: File Validation Failed, File name: "+n.name+", File size: "+n.size+", Message: "+o);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:break;default:this.debug("Error Code: "+p+", File name: "+n.name+", File size: "+n.size+", Message: "+o);break}}catch(m){this.debug(m)}},fileNameList:[],iscomplate:false,uploadSuccess:function(n,p){var m=p,o=$("#photo_album_list").val();b={album_id:o,field:m};HN.ajax.post("http://www.tazai.com/photo/photo/add",b,function(q){$("#"+n.id).find("img").unbind("mouseover mouseout").show().css("cursor","default").attr("src","http://css.tazai.com/ui/mangoq/2010v1/images/ico/action_del_ok.gif");i.fileNameList.push(q);i.savePhoto(o)},function(){$("#"+n.id).css("background-color","#c9c");$("#"+n.id).find("img").unbind("mouseover mouseout").show().css("cursor","default").attr("src","http://css.tazai.com/ui/mangoq/2010v1/images/ico/action_del_on.gif")})},savePhoto:function(s){if(i.iscomplate){var q=0,n=i.fileNameList.length,m=(Math.ceil(n/5))*140+145;if(m>565){m=565}HN.dialog.reSize(615,m);var p=['<div class="fp-frame fp-frame-3">','<div class="fp-title fp-frame-3-add">','<div class="l">\u5b8c\u5584\u7167\u7247\u4fe1\u606f</div>','<div class="r"></div>','<div class="c fp-piclists-line"></div>',"</div>",'<div class="fp-piclists" id="fp_pic_lists" style="height:auto; margin:10px 0 10px 10px;">',"</div>",'<div class="c"></div>','<div class="fp-save">','<div class="fp-save-button">','<input type="image" class="hn-dialog-close" src="http://css.tazai.com/ui/mangoq/2010v1/images/button/album_save2.jpg" name="">',"</div>","</div>","</div>"].join("");$("#hn-dialog-body").html(p);if(m==565){$("#fp_pic_lists").css("height","455px").css("overflow-y","scroll")}for(q;q<n;q++){$("#fp_pic_lists").append('<div name="74" class="fp-piclist" style="position: relative;"> <dl> <dt> <div class="fp-piclists-del"></div> <div class="c" style="height: 80px;"><a href="javascript:"><img border="0" src="http://img.tazai.com/photo/small/'+i.fileNameList[q].key+'"></a></div> <div class="fp-piclists-del"><a href="javascript:"><img src="http://css.tazai.com/ui/mangoq/2010v1/images/ico/photo_setdefault2.jpg" is_cover="true" key="'+i.fileNameList[q].key+'" class="set_cover_btn" name="'+i.fileNameList[q].id+'"></a><a href="javascript:"><img border="0" title="\u5220\u9664\u76f8\u7247" src="http://css.tazai.com/ui/mangoq/2010v1/images/ico/photo_del.gif" key="'+i.fileNameList[q].key+'" name="'+i.fileNameList[q].id+'" class="del_photo_btn"></a></div> <div class="fp-piclists-floattips1" style="position: absolute; top: 76px; left: 58px; display: none;">\u8bbe\u5c01\u9762</div> </dt> <dd> <div> <div class="fp-piclists-write"><a href="javascript:"><img height="12" width="12" border="0" src="http://css.tazai.com/ui/mangoq/2010v1/images/ico/write.gif" title="\u7f16\u8f91\u76f8\u7247"></a></div> <div class="fp-piclists-title"><a alt="'+i.fileNameList[q].id+'" href="javascript:">'+i.fileNameList[q].des+"</a></div> </div> </dd> </dl> </div>")}$(".hn-dialog-close").unbind("click").bind("click",function(){if(e==1){HN.dialog.close()}else{if(e==2){HN.dialog.close();location.href="/home/profile/info/"+a+"#photo_title_line"}else{HN.dialog.close();c.call()}}});$("#fp_pic_lists").find(".del_photo_btn").unbind("click").bind("click",function(){var u=$(this),t=[];t.push(u.attr("name"));b={cover_photo_id:s,photo_id:t};obj=u.parent().parent().parent().parent().parent();r(obj,b)});var o="http://www.tazai.com/photo/photo/setdes";HN.tInput({target:".fp-piclists-title a",url:o,id:"photo_id",value:"photo_des"});$(".fp-piclists-write a").unbind("click").bind("click",(function(){var t=$(this).parent().siblings().find("a");HN.tInput({target:t,url:o,id:"photo_id",value:"photo_des"})}));function r(u,t){HN.ajax.post("http://www.tazai.com/photo/photo/delete",t,function(v){u.fadeOut(200,function(){obj.remove()})},function(){alert("\u5220\u9664\u5931\u8d25")})}$("#fp_pic_lists").find(".set_cover_btn").unbind("click").bind("click",function(){var t=$(this);HN.ajax.post("http://www.tazai.com/photo/album/setcover",{album_id:s,photo_id:t.attr("name"),key:t.attr("key")},function(u){$("#fp_pic_lists").find(".set_cover_btn").attr("src","http://css.tazai.com/ui/mangoq/2010v1/images/ico/photo_setdefault2.jpg");t.attr("src","http://css.tazai.com/ui/mangoq/2010v1/images/ico/photo_setdefault.jpg");t.attr("is_cover","true")},function(){alert("\u8bbe\u7f6e\u5931\u8d25")})});$(".set_cover_btn").bind("mouseover",function(){$(this).parent().parent().siblings(".fp-piclists-floattips1").fadeIn(500)});$(".set_cover_btn").bind("mouseout",function(){$(this).parent().parent().siblings(".fp-piclists-floattips1").fadeOut(100)})}},uploadComplete:function(m){if(this.getStats().files_queued===0){i.iscomplate=true}else{i.iscomplate=false;this.startUpload()}},queueComplete:function(){this.debug("queueComplete")},swfUploadPreLoad:function(){this.debug("swfUploadPreLoad")},swfUploadLoadFailed:function(){this.debug("swfUploadLoadFailed")}};l=new SWFUpload(i.options())})},function(f){alert("\u83b7\u53d6\u76f8\u518c\u5217\u8868\u5931\u8d25")})}}});
//10/12/30 
