HN.comment=function(a,m){var b={id:"hn-comment",sid:0,url:BASEURL+"photo/comment/",project:"photo",theme:"beta",loading:CSSURL+"ui/mangoq/2010v1/images/ico/loading.gif"},i=1,f=0;if(HN.isString(m)){b.sid=m}else{$.extend(b,m)}var e=$("#"+b.id),n=$("#"+b.id+"-tmpl"),j=$("#"+b.id+"-pages"),o=$("#"+b.id+"-pages-tmpl"),d=$("#"+b.id+"-reply-tmpl"),g=$("#"+b.id+"-create"),h=$("#"+b.id+"-content");if(!e.length){HN.debug("\u6ca1\u6709\u627e\u5230\u76f8\u5173\u7684HTML");return false}if(!n.length){HN.debug("\u6ca1\u6709\u627e\u5230\u76f8\u5173\u7684\u6a21\u677f");return false}if(!b.sid){HN.debug("\u8bf7\u4f20\u5165SID");return false}e.unbind("click").click(HN.delegate({"a.show-reply":function(){var s=$(this),r=$("#reply-"+s.attr("rel")),q=s.attr("class"),p=r.find(".hn-comment-reply-box");if(q.split(" ").length>1){p.find("input.hn-reply-content").val("\u56de\u590d "+$("#reply-"+q.split("-").pop()).find(".reply-nickname").text()+"\uff1a")}if(p.is(":visible")){t();return false}if(r.is(":visible")){p.slideDown(200,t)}else{p.show();r.slideDown(200,t)}function t(){HN.scrollTo(p);p.find(".hn-reply-content").focus()}HN.face(r.find("img.face-trigger"),r.find("input.hn-reply-content"));return false},"input.hn-reply-button":function(){var r=$(this).attr("className").split("-").pop(),p=$("input.hn-reply-content","#reply-"+r),q=p.val();if(HN.trim(q)==""){HN.debug("\u56de\u590d\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a");p.shakeElem();return false}else{if(HN.trim(q).length>=140){p.val(q.substring(0,128));alert("\u8d85\u51fa140\u4e2a\u5b57\u7b26\u7684\u957f\u5ea6\u9650\u5236\uff0c\u7cfb\u7edf\u5df2\u9ed8\u8ba4\u622a\u53d6!");p.shakeElem();return false}}HN.ajax.post(b.url+"reply",{photo_id:b.sid,comment_id:r,content:q},function(s){var t=HN.tmpl(d.html(),s);$("div.hn-comment-reply-box","#reply-"+r).after(t);p.val("")},function(s){p.shakeElem()});return false},"a.del-comment":function(){var q=$(this).attr("className").split("-").pop(),p=$("#comment-"+q);HN.ajax.post(b.url+"delcomment",{id:q},function(r){p.fadeOut(300)},function(r){})},"a.del-reply":function(){var q=$(this).attr("className").split("-").pop(),p=$("#reply-"+q);HN.ajax.post(b.url+"delreply",{id:q},function(r){p.fadeOut(300)},function(r){})},"img.face-trigger":function(){var r=$(this).attr("className").split("-").pop(),p=$("#reply-"+r),q=p.find("input.hn-reply-content");HN.debug("x");HN.face($(this),q);return false}}));j.unbind("click").click(HN.delegate({"a[rel]":function(){l($(this).attr("rel"));return false},"img.prevnext":function(){l($(this).parent("a").attr("rel"));return false}}));g.unbind("click").click(c);l(i);function l(p){HN.debug(p);var q={page:p,id:b.sid};e.html('<div style="text-align:center; padding: 10px"><img src="'+b.loading+'" /></div>');HN.ajax.get(b.url+"getlist",q,function(u){var r=u.comment,s=r.length;if(s){var w=[],t=n.html();for(var v=0;v<s;v++){w.push(HN.tmpl(t,r[v]))}e.html(w.join(""));k(j,u)}else{e.html('<p id="hn-no-comment">\u8fd8\u6ca1\u6709\u8bc4\u8bba\u3002</p>');j.hide().html("")}},function(r){e.html(r)})}function k(w,s){if(s.total<2){return w.hide()}var v=5,q=o.html(),p=s.total,u=s.page,r=Math.ceil(v/2),t={min:0,max:p,page:u,total:p};if(s.total>v){(u-r)>0?(t.min=u-r):(t.min=0,t.max=v);(u+r)>p?(t.max=p,t.min=p-v):((t.max!=v)&&(t.max=u+r))}w.html(HN.tmpl(q,t)).show().find("img[over]").hover(function(){this.src=[$(this).attr("over"),$(this).attr("over",this.src)][0]});return w}function c(){var p=h.val(),r=$("#comment-post-loading"),q={photo_id:b.sid,content:p};if(HN.trim(p)==""){HN.debug("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff01");h.shakeElem();return false}else{if(HN.trim(p).length>140){h.val(p.substring(0,140));alert("\u8d85\u51fa140\u4e2a\u5b57\u7b26\u7684\u957f\u5ea6\u9650\u5236!");h.shakeElem();return false}}r.show();HN.ajax.post(b.url+"create",q,function(s){r.hide();$("#hn-no-comment").remove();s.reply=[];var t=$(HN.tmpl(n.html(),s)).hide();h.val("");e.prepend(t.slideDown())},function(s){r.hide();h.shakeElem()})}};
//11/01/06 
