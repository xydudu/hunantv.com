
window.HN&&window.jQuery&&(HN.face=function($o,$taget){var box='<div id="face-show-box" style="position:absolute; display:none;" class="f-msgbox w-w242h99"><div class="f-top"> <div class="f-top-l"></div><div class="f-top-r"></div><div class="f-top-m w-top-m"></div></div><div class="f-main"><div class="f-main-l w-main-l"></div><div class="f-main-m w-main-m" id="content_box_face">      </div><div class="f-main-r w-main-r"><div class="f-main-r-bg"></div></div></div><div class="f-buttom"><div class="f-buttom-l"></div><div class="f-buttom-r"></div><div class="f-buttom-m w-buttom-m"><div class="f-buttom-m-bg"></div></div></div></div>';if($o&&$taget){$o.unbind('click').click(function(){var o=$(this),$box,offset=o.offset(),facehtml='';for(i=0;i<=18;i++){facehtml+='<a href="javascript:" title="%face_'+i+'%"><img border="0" src="http:\/\/css.mangoq.com\/ui\/mangoq\/2010v1\/images\/ico\/face_'+i+'.jpg" \/><\/a> ';}if(!$('#face-show-box').length){$('body').append($(box));}$box=$('#face-show-box');$box.css({left:offset.left,top:offset.top-79});$box.find('#content_box_face').html(facehtml);$box.show();$box.find('a').unbind('click').bind('click',function(){var c=$taget.val(),fc=$(this).attr('title');var
textarea=$taget[0],rangeData=getCursorPosition(textarea),text=fc;var oValue,nValue,oR,sR,nStart,nEnd,st;setCursorPosition(textarea,rangeData);if(textarea.setSelectionRange){oValue=textarea.value;nValue=oValue.substring(0,rangeData.start)+text+oValue.substring(rangeData.end);nStart=nEnd=rangeData.start+text.length;st=textarea.scrollTop;textarea.value=nValue;if(textarea.scrollTop!=st){textarea.scrollTop=st;}textarea.setSelectionRange(nStart,nEnd);}else if(textarea.createTextRange){sR=document.selection.createRange();sR.text=text;sR.setEndPoint('StartToEnd',sR);sR.select();}$taget.focus();$box.hide();});$(document).unbind('mousedown').bind('mousedown',function(event){if(!$(event.target).closest('#face-show-box').length){$box.hide();}});});}function setCursorPosition(textarea,rangeData){if(!rangeData){alert("You must get cursor position first.");}if(textarea.setSelectionRange){textarea.focus();textarea.setSelectionRange(rangeData.start,rangeData.end);}else if(textarea.createTextRange){var oR=textarea.createTextRange();if(textarea.value.length===rangeData.start){oR.collapse(false);oR.select();}else{oR.moveToBookmark(rangeData.bookmark);oR.select();}}}function getCursorPosition(textarea){var rangeData={text:"",start:0,end:0};textarea.focus();if(textarea.setSelectionRange){rangeData.start=textarea.selectionStart;rangeData.end=textarea.selectionEnd;rangeData.text=(rangeData.start!=rangeData.end)?textarea.value.substring(rangeData.start,rangeData.end):"";}else if(document.selection){var i,oS=document.selection.createRange(),oR=document.body.createTextRange();oR.moveToElementText(textarea);rangeData.text=oS.text;rangeData.bookmark=oS.getBookmark();for(i=0;oR.compareEndPoints('StartToStart',oS)<0&&oS.moveStart("character",-1)!==0;i++){if(textarea.value.charAt(i)=='\n'){i++;}}rangeData.start=i;rangeData.end=rangeData.text.length+rangeData.start;}return rangeData;}return{faceTo:function($str){$str=$str.replace(/\%face_([0-9]|1[0-8])\%/g,'<img onerror="this.src=\'http:\/\/css.mangoq.com\/ui\/mangoq\/2010v1\/images\/ico\/face_2.jpg\';" src="http:\/\/css.mangoq.com\/ui\/mangoq\/2010v1\/images\/ico\/face_$1.jpg"\/>');return $str;}}});